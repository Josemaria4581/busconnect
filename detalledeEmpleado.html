<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Stitch Design</title>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Work+Sans:wght@400;500;600;700" onload="this.rel='stylesheet'" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1173d4",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "content-light": "#0d141b",
                        "content-dark": "#ffffff",
                        "subtle-light": "#4c739a",
                        "subtle-dark": "#a0aec0",
                        "border-light": "#cfdbe7",
                        "border-dark": "#374151"
                    },
                    fontFamily: {
                        "display": ["Work Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display text-content-light dark:text-content-dark">
<div class="flex flex-col min-h-screen">
<header class="sticky top-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm z-10">
<div class="flex items-center p-4">
<button class="p-2 -ml-2" onclick="window.location.href='gestiondeEmpleados.html'">
<span class="material-symbols-outlined text-content-light dark:text-content-dark">arrow_back</span>
</button>
<h1 id="roleTitle" class="text-lg font-bold text-center flex-1 pr-8">Conductor</h1>
</div>
</header>
<main class="flex-1">
<div class="p-4 flex flex-col items-center text-center">
<div id="avatar" class="w-32 h-32 rounded-full bg-cover bg-center mb-4" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBg53px3-_irQz9d8lKlWc44LmKiXWILd3Cv2wElsYBoniHBdvNt8XmvWUEXweLj7DwcUh8XPwBK1fVwykjiTjsIL1Lak1cuixTEWfdefkPp1Xnz1hwRItmat5Kvxb0zFtHZyKl4Uk0XSfAsgoMgu1B7F17Fvst8AopveMeqbZY5eNVLCZqLK2d04Z1jiTXW3xb90MziACNb9jeIkLiS-W5mZLD4DwLLFHoZoPnaATfmUkiZ-MhQfe4pU3n0TrUYmJOChWKY43o6Q');"></div>
<h2 class="text-2xl font-bold">Ricardo García</h2>
<p class="text-subtle-light dark:text-subtle-dark">Conductor</p>
<p class="text-subtle-light dark:text-subtle-dark text-sm">ID: 12345</p>
</div>
<div class="px-4 space-y-4">
<div>
<h3 class="text-lg font-bold mb-2">Información Personal</h3>
<div class="divide-y divide-border-light dark:divide-border-dark bg-white dark:bg-primary/5 rounded-lg border border-border-light dark:border-border-dark">
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Nombre</p>
<p class="text-sm text-right">Ricardo</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Apellido</p>
<p class="text-sm text-right">García</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">F. Nacimiento</p>
<p class="text-sm text-right">15/03/1985</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Nacionalidad</p>
<p class="text-sm text-right">Española</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Dirección</p>
<p class="text-sm text-right">Calle Mayor, 123, Madrid</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Teléfono</p>
<p class="text-sm text-right">+34 666 777 888</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Email</p>
<p class="text-sm text-right truncate">ricardo.garcia@email.com</p>
</div>
</div>
</div>
<div>
<h3 class="text-lg font-bold mb-2">Licencias</h3>
<div class="divide-y divide-border-light dark:divide-border-dark bg-white dark:bg-primary/5 rounded-lg border border-border-light dark:border-border-dark">
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Tipo</p>
<p class="text-sm text-right font-semibold">D</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Número</p>
<p class="text-sm text-right">123456789</p>
</div>
<div class="grid grid-cols-2 p-3">
<p class="text-sm text-subtle-light dark:text-subtle-dark">Caducidad</p>
<p class="text-sm text-right text-red-500">15/03/2025</p>
</div>
</div>
</div>
<div>
<h3 class="text-lg font-bold mb-2">Historial de Rutas</h3>
<div class="space-y-2">
<div class="flex items-center gap-4 bg-white dark:bg-primary/5 p-3 rounded-lg border border-border-light dark:border-border-dark">
<div class="flex items-center justify-center rounded-lg bg-primary/10 dark:bg-primary/20 shrink-0 size-10">
<span class="material-symbols-outlined text-primary">directions_bus</span>
</div>
<div class="flex-1">
<p class="font-medium">Madrid - Barcelona</p>
<p class="text-sm text-subtle-light dark:text-subtle-dark">Ruta 1</p>
</div>
<span class="material-symbols-outlined text-subtle-light dark:text-subtle-dark">chevron_right</span>
</div>
<div class="flex items-center gap-4 bg-white dark:bg-primary/5 p-3 rounded-lg border border-border-light dark:border-border-dark">
<div class="flex items-center justify-center rounded-lg bg-primary/10 dark:bg-primary/20 shrink-0 size-10">
<span class="material-symbols-outlined text-primary">directions_bus</span>
</div>
<div class="flex-1">
<p class="font-medium">Barcelona - Valencia</p>
<p class="text-sm text-subtle-light dark:text-subtle-dark">Ruta 2</p>
</div>
<span class="material-symbols-outlined text-subtle-light dark:text-subtle-dark">chevron_right</span>
</div>
<div class="flex items-center gap-4 bg-white dark:bg-primary/5 p-3 rounded-lg border border-border-light dark:border-border-dark">
<div class="flex items-center justify-center rounded-lg bg-primary/10 dark:bg-primary/20 shrink-0 size-10">
<span class="material-symbols-outlined text-primary">directions_bus</span>
</div>
<div class="flex-1">
<p class="font-medium">Valencia - Sevilla</p>
<p class="text-sm text-subtle-light dark:text-subtle-dark">Ruta 3</p>
</div>
<span class="material-symbols-outlined text-subtle-light dark:text-subtle-dark">chevron_right</span>
</div>
</div>
</div>
</div>
</main>
<footer class="sticky bottom-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm p-4 mt-4">
<div class="flex gap-4">
<button id="btnEditar" class="flex-1 py-2.5 px-4 rounded-lg bg-primary/20 dark:bg-primary/30 text-primary font-bold text-center">
                    Editar
                </button>
<button id="btnGuardar" class="flex-1 py-2.5 px-4 rounded-lg bg-primary text-white font-bold text-center">
                    Guardar
                </button>
</div>
</footer>
</div>
<script>
 (function guard(){
   const role = localStorage.getItem('role');
   if (!role) { window.location.href = 'inicioSesion.html'; return; }
   if (role === 'cliente') { window.location.href = 'gestiondeRutas.html'; }
 })();

 (function renderEmpleado(){
   function roleLabel(r){ const m={driver:'Conductor',admin:'Administrador',office:'Oficina'}; return m[(r||'').toLowerCase()]||r||'Empleado'; }
   function fmtDateISOtoES(iso){ if(!iso) return '—'; const d=new Date(iso); if(isNaN(d)) return iso; const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const yy=d.getFullYear(); return dd+'/'+mm+'/'+yy; }

   let emp=null; try{ emp=JSON.parse(localStorage.getItem('empleado_detalle')||'null'); }catch{}
   if(!emp){ const id=new URLSearchParams(location.search).get('id'); if(id){ try{ const l=JSON.parse(localStorage.getItem('empleados_v1')||'[]'); emp=l.find(e=>e.id===id)||null; }catch{} } }
   if(!emp) emp={ id:'—', name:'—', role:'Empleado' };

   const intro = document.querySelector('main .p-4.flex.flex-col.items-center.text-center');
   if (intro){
     const nameH2 = intro.querySelector('h2'); if (nameH2) nameH2.textContent = emp.name || [emp.givenName, emp.surname].filter(Boolean).join(' ') || '—';
     const ps = intro.querySelectorAll('p');
     if (ps[0]) ps[0].textContent = roleLabel(emp.role);
     if (ps[1]) ps[1].textContent = 'ID: ' + (emp.id||'—');
     const avatar = intro.querySelector('div.w-32.h-32.rounded-full'); if (avatar && emp.avatar) avatar.style.backgroundImage = "url('"+(emp.avatar)+"')";
   }

   const rt = document.getElementById('roleTitle'); if (rt) rt.textContent = roleLabel(emp.role);

   const blocks = document.querySelectorAll('main .divide-y');
   if (blocks.length >= 1){
     const infoRows = blocks[0].querySelectorAll('.grid.grid-cols-2.p-3');
     const vals = [
       emp.givenName || (emp.name||'').split(' ')[0] || '—',
       emp.surname || (emp.name||'').split(' ').slice(1).join(' ') || '—',
       fmtDateISOtoES(emp.birthDate),
       emp.nationality || '—',
       emp.address || '—',
       emp.phone || '—',
       emp.email || '—'
     ];
     infoRows.forEach((row,i)=>{ const el=row && row.lastElementChild; if(el && i<vals.length) el.textContent = vals[i]; });
   }
   if (blocks.length >= 2){
     const licRows = blocks[1].querySelectorAll('.grid.grid-cols-2.p-3');
     const lvals = [ emp.licenseType || '—', emp.licenseNumber || '—', fmtDateISOtoES(emp.licenseExpiry) ];
     licRows.forEach((row,i)=>{ const el=row && row.lastElementChild; if(el && i<lvals.length) el.textContent = lvals[i]; });
   }
 })();
</script>
<script>
  (function empleadosEdit(){
    const LS_EMPL = 'empleados_v1';
    function loadSelected(){ try { return JSON.parse(localStorage.getItem('empleado_detalle')||'null'); } catch { return null; } }
    function saveSelected(emp){ localStorage.setItem('empleado_detalle', JSON.stringify(emp)); }
    function loadList(){ try { return JSON.parse(localStorage.getItem(LS_EMPL)||'[]'); } catch { return []; } }
    function saveList(l){ localStorage.setItem(LS_EMPL, JSON.stringify(l)); }

    let editing = false;

    function enterEdit(){
      if (editing) return; editing = true;
      const emp = loadSelected()||{};
      const blocks = document.querySelectorAll('main .divide-y');
      if (blocks.length >= 1){
        const infoRows = blocks[0].querySelectorAll('.grid.grid-cols-2.p-3');
        const infoMap = [
          {key:'givenName', type:'text', val: emp.givenName || (emp.name||'').split(' ')[0] || ''},
          {key:'surname', type:'text', val: emp.surname || (emp.name||'').split(' ').slice(1).join(' ') || ''},
          {key:'birthDate', type:'date', val: (emp.birthDate||'').slice(0,10)},
          {key:'nationality', type:'text', val: emp.nationality||''},
          {key:'address', type:'text', val: emp.address||''},
          {key:'phone', type:'text', val: emp.phone||''},
          {key:'email', type:'email', val: emp.email||''}
        ];
        infoRows.forEach((row,i)=>{
          const valCell=row && row.lastElementChild; const m=infoMap[i]; if(!valCell||!m) return;
          valCell.innerHTML = '<input data-key="'+m.key+'" type="'+m.type+'" class="w-full bg-white dark:bg-slate-800 border border-border-light dark:border-border-dark rounded-md px-2 py-1 text-sm" value="'+String(m.val||'').replace(/"/g,'&quot;')+'">';
        });
      }
      if (blocks.length >= 2){
        const licRows = blocks[1].querySelectorAll('.grid.grid-cols-2.p-3');
        const licMap = [
          {key:'licenseType', type:'text', val: emp.licenseType||''},
          {key:'licenseNumber', type:'text', val: emp.licenseNumber||''},
          {key:'licenseExpiry', type:'date', val: (emp.licenseExpiry||'').slice(0,10)}
        ];
        licRows.forEach((row,i)=>{
          const valCell=row && row.lastElementChild; const m=licMap[i]; if(!valCell||!m) return;
          valCell.innerHTML = '<input data-key="'+m.key+'" type="'+m.type+'" class="w-full bg-white dark:bg-slate-800 border border-border-light dark:border-border-dark rounded-md px-2 py-1 text-sm" value="'+String(m.val||'').replace(/"/g,'&quot;')+'">';
        });
      }
    }

    function saveEdit(){
      if (!editing) return;
      const emp = loadSelected()||{};
      const inputs = document.querySelectorAll('input[data-key]');
      inputs.forEach(inp => { const k=inp.getAttribute('data-key'); if(!k) return; emp[k] = inp.value || ''; });
      if (emp.givenName || emp.surname) { emp.name = [emp.givenName||'', emp.surname||''].join(' ').trim() || emp.name; }
      saveSelected(emp);
      const list = loadList();
      const idx = list.findIndex(e => e.id === emp.id);
      if (idx >= 0) { list[idx] = Object.assign({}, list[idx], emp); saveList(list); }
      // Re-render estado de vista simple recargando
      location.reload();
    }

    window.addEventListener('DOMContentLoaded', () => {
      const role = localStorage.getItem('role');
      const btnE = document.getElementById('btnEditar');
      const btnG = document.getElementById('btnGuardar');
      if (btnE) btnE.addEventListener('click', enterEdit);
      if (btnG) btnG.addEventListener('click', saveEdit);
      if (role && role !== 'admin') {
        // Bloquear edición para no-admin
        if (btnE) { btnE.disabled = true; btnE.classList.add('opacity-60','cursor-not-allowed'); }
        if (btnG) { btnG.disabled = true; btnG.classList.add('opacity-60','cursor-not-allowed'); }
      }
    });
  })();
</script>
</body></html>
